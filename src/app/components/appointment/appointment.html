<section class="appointment-section" id="agenda-cita">
  <div class="container">
    <div class="section-header">
      <h2>üìÖ Agenda tu Cita</h2>
      <p>Reserva una consulta con nuestros expertos en ingenier√≠a civil</p>
    </div>

    <div class="appointment-container">
      <div class="appointment-info">
        <div class="info-card">
          <div class="icon">üïí</div>
          <h3>Horarios Disponibles</h3>
          <p>Lunes a Viernes: 8:00 AM - 6:00 PM</p>
          <p>S√°bados: 9:00 AM - 2:00 PM</p>
        </div>

        <div class="info-card">
          <div class="icon">üìç</div>
          <h3>Ubicaci√≥n</h3>
          <p>Consultas presenciales y virtuales disponibles</p>
          <p>Agenda flexible seg√∫n tu disponibilidad</p>
        </div>

        <div class="info-card">
          <div class="icon">‚úÖ</div>
          <h3>Confirmaci√≥n Autom√°tica</h3>
          <p>Recibir√°s confirmaci√≥n por email</p>
          <p>Evento agregado a tu calendario</p>
        </div>
      </div>

      <div class="appointment-form-container">
        <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()" class="appointment-form">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nombre Completo *</label>
              <input 
                type="text" 
                id="name" 
                formControlName="name" 
                placeholder="Tu nombre completo"
                [class.error]="appointmentForm.get('name')?.invalid && appointmentForm.get('name')?.touched"
              >
              <div class="error-message" *ngIf="appointmentForm.get('name')?.invalid && appointmentForm.get('name')?.touched">
                <span *ngIf="appointmentForm.get('name')?.errors?.['required']">El nombre es requerido</span>
                <span *ngIf="appointmentForm.get('name')?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email *</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                placeholder="tu@email.com"
                [class.error]="appointmentForm.get('email')?.invalid && appointmentForm.get('email')?.touched"
              >
              <div class="error-message" *ngIf="appointmentForm.get('email')?.invalid && appointmentForm.get('email')?.touched">
                <span *ngIf="appointmentForm.get('email')?.errors?.['required']">El email es requerido</span>
                <span *ngIf="appointmentForm.get('email')?.errors?.['email']">Ingresa un email v√°lido</span>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="phone">Tel√©fono *</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone" 
                placeholder="+52 (123) 456-7890"
                [class.error]="appointmentForm.get('phone')?.invalid && appointmentForm.get('phone')?.touched"
              >
              <div class="error-message" *ngIf="appointmentForm.get('phone')?.invalid && appointmentForm.get('phone')?.touched">
                <span *ngIf="appointmentForm.get('phone')?.errors?.['required']">El tel√©fono es requerido</span>
                <span *ngIf="appointmentForm.get('phone')?.errors?.['pattern']">Ingresa un tel√©fono v√°lido</span>
              </div>
            </div>

            <div class="form-group">
              <label for="service">Servicio de Inter√©s *</label>
              <select 
                id="service" 
                formControlName="service"
                [class.error]="appointmentForm.get('service')?.invalid && appointmentForm.get('service')?.touched"
              >
                <option value="">Selecciona un servicio</option>
                <option value="Dise√±o Estructural">Dise√±o Estructural</option>
                <option value="An√°lisis de Suelos">An√°lisis de Suelos</option>
                <option value="Construcci√≥n Residencial">Construcci√≥n Residencial</option>
                <option value="Construcci√≥n Comercial">Construcci√≥n Comercial</option>
                <option value="Rehabilitaci√≥n Estructural">Rehabilitaci√≥n Estructural</option>
                <option value="Consultor√≠a T√©cnica">Consultor√≠a T√©cnica</option>
                <option value="Otro">Otro</option>
              </select>
              <div class="error-message" *ngIf="appointmentForm.get('service')?.invalid && appointmentForm.get('service')?.touched">
                <span *ngIf="appointmentForm.get('service')?.errors?.['required']">Selecciona un servicio</span>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="date">Fecha de Cita *</label>
              <input 
                type="date" 
                id="date" 
                formControlName="date" 
                (change)="onDateChange($event)"
                [class.error]="appointmentForm.get('date')?.invalid && appointmentForm.get('date')?.touched"
              >
              <div class="error-message" *ngIf="appointmentForm.get('date')?.invalid && appointmentForm.get('date')?.touched">
                <span *ngIf="appointmentForm.get('date')?.errors?.['required']">Selecciona una fecha</span>
              </div>
            </div>

            <div class="form-group">
              <label for="time">Hora de Cita *</label>
              <select 
                id="time" 
                formControlName="time"
                (change)="onTimeChange($event)"
                [class.error]="appointmentForm.get('time')?.invalid && appointmentForm.get('time')?.touched"
              >
                <option value="">Selecciona una hora</option>
                <option *ngFor="let slot of availableSlots" [value]="slot">{{slot}}</option>
              </select>
              <div class="error-message" *ngIf="appointmentForm.get('time')?.invalid && appointmentForm.get('time')?.touched">
                <span *ngIf="appointmentForm.get('time')?.errors?.['required']">Selecciona una hora</span>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="description">Descripci√≥n Adicional</label>
            <textarea 
              id="description" 
              formControlName="description" 
              placeholder="Describe brevemente tu proyecto o consulta (opcional)"
              rows="4"
              maxlength="500"
            ></textarea>
            <div class="char-count">
              {{appointmentForm.get('description')?.value?.length || 0}}/500 caracteres
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn-primary" 
              [disabled]="appointmentForm.invalid || isSubmitting"
            >
              <span *ngIf="!isSubmitting">üìÖ Agendar Cita</span>
              <span *ngIf="isSubmitting">‚è≥ Agendando...</span>
            </button>
          </div>

          <!-- Mensajes de estado -->
          <div class="form-messages" *ngIf="submitSuccess || submitError">
            <div class="success-message" *ngIf="submitSuccess">
              <div class="message-icon">‚úÖ</div>
              <div class="message-content">
                <h4>¬°Cita Agendada Exitosamente!</h4>
                <p>Tu cita ha sido agendada y se ha abierto Google Calendar para confirmar. Tambi√©n recibir√°s un email de confirmaci√≥n.</p>
                <button type="button" class="btn-secondary" (click)="resetForm()">Agendar Otra Cita</button>
              </div>
            </div>

            <div class="error-message" *ngIf="submitError">
              <div class="message-icon">‚ùå</div>
              <div class="message-content">
                <h4>Error al Agendar</h4>
                <p>{{submitError}}</p>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="calendar-integration">
      <div class="integration-info">
        <h3>üîÑ Sincronizaci√≥n con Google Calendar</h3>
        <p>Al agendar tu cita, se crear√° autom√°ticamente un evento en tu calendario de Google con todos los detalles de la consulta.</p>
        <div class="integration-features">
          <div class="feature">
            <span class="feature-icon">üìß</span>
            <span>Invitaci√≥n por email</span>
          </div>
          <div class="feature">
            <span class="feature-icon">‚è∞</span>
            <span>Recordatorios autom√°ticos</span>
          </div>
          <div class="feature">
            <span class="feature-icon">üì±</span>
            <span>Sincronizaci√≥n m√≥vil</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
